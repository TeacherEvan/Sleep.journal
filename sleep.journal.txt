# Sleep Journal Application Documentation

## Table of Contents

1. [Application Overview](#application-overview)
2. [Purpose and Features](#purpose-and-features)
3. [Architecture Overview](#architecture-overview)
4. [Technology Stack](#technology-stack)
5. [User Flows](#user-flows)
6. [Data Models](#data-models)
7. [Security Considerations](#security-considerations)
8. [Deployment Strategy](#deployment-strategy)
9. [Future Enhancements](#future-enhancements)

## Application Overview

The Sleep Journal is a cross-platform mobile application designed for tracking daily sleep-related journal entries with associated emotional and psychological metrics. Built using .NET MAUI 9.0, it provides users with a simple yet effective tool for maintaining personal wellness records through structured journaling.

## Purpose and Features

### Core Purpose
The application serves as a digital wellness companion that helps users:
- Maintain consistent journaling habits for better sleep quality
- Track emotional states and identify patterns over time
- Monitor social anxiety levels and their correlation with sleep
- Assess regretability of daily actions and decisions
- Build self-awareness through data-driven insights

### Key Features

#### ğŸ“ Journal Entry Management
- Text-based entries limited to 200 characters for focused reflection
- Automatic timestamping of all entries
- Chronological ordering with most recent entries first

#### ğŸ˜Š Emotional Tracking Metrics
- **Mood Scale**: 1-10 rating system for daily emotional state
- **Social Anxiety Level**: 1-10 assessment of social interaction comfort
- **Regretability Score**: 1-10 evaluation of daily decisions and actions

#### ğŸ’¾ Data Persistence
- Local SQLite database for offline-first functionality
- Automatic data synchronization across app sessions
- Data integrity preservation with Unicode support

#### ğŸ¯ User Experience
- Real-time input validation with clear error messaging
- Responsive UI with loading states during save operations
- Cross-platform compatibility (Android primary, iOS/Windows/Mac support available)

#### ğŸ”§ Advanced Features
- Comprehensive test suite with 70+ unit and integration tests
- Async initialization patterns for optimal performance
- Dependency injection for maintainable architecture
- Comprehensive error handling and logging

## Architecture Overview

### High-Level System Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UI Layer      â”‚    â”‚ Business Logic  â”‚    â”‚ Data Layer      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ MainPage.xaml â”‚â—„â”€â”€â–ºâ”‚ â€¢ ViewModels    â”‚â—„â”€â”€â–ºâ”‚ â€¢ SQLite DB     â”‚
â”‚ â€¢ XAML Bindings â”‚    â”‚ â€¢ Validation    â”‚    â”‚ â€¢ IDataService  â”‚
â”‚ â€¢ User Input    â”‚    â”‚ â€¢ Commands      â”‚    â”‚ â€¢ CRUD Ops      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Services      â”‚
                    â”‚                 â”‚
                    â”‚ â€¢ DI Container  â”‚
                    â”‚ â€¢ Logging       â”‚
                    â”‚ â€¢ Configuration â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MVVM Architecture Pattern

#### Models Layer
- **JournalEntry**: Core data entity for sleep journal entries
- **UserSettings**: Application configuration and preferences
- **Passage**: Future content management (currently unused)

#### ViewModels Layer
- **MainPageViewModel**: Handles UI logic, validation, and data binding
- Implements INotifyPropertyChanged via CommunityToolkit.Mvvm
- Manages command execution with CanExecute logic
- Provides user-friendly error messaging

#### Views Layer
- **MainPage.xaml**: XAML-based UI with data binding
- Responsive layout with ScrollView and VerticalStackLayout
- Semantic properties for accessibility

#### Services Layer
- **IDataService**: Interface for data operations
- **SQLiteDataService**: SQLite implementation with async patterns
- Dependency injection via MauiProgram.cs

### Key Design Patterns

#### Repository Pattern
- Interface-based data access abstraction
- Testable data operations
- Consistent async API with CancellationToken support

#### Async Initialization Pattern
- Lazy loading of SQLite database connection
- Thread-safe initialization with SemaphoreSlim
- Prevents UI blocking during startup

#### Error Handling Strategy
- Try-catch blocks around all database operations
- User-friendly error messages in ViewModels
- Comprehensive logging for debugging

## Technology Stack

### Core Framework
- **.NET MAUI 9.0**: Cross-platform UI framework
- **C# 12**: Modern language features and async patterns
- **XAML**: Declarative UI markup

### Data Layer
- **SQLite-net-pcl**: Lightweight ORM for local database
- **SQLite**: Embedded relational database engine
- **Async/Await**: Non-blocking database operations

### MVVM Implementation
- **CommunityToolkit.Mvvm**: Source generators and MVVM helpers
- **ObservableObject**: Base class for property change notifications
- **RelayCommand**: Command implementation with CanExecute support

### Testing Framework
- **xUnit**: Unit testing framework
- **FluentAssertions**: Readable assertion library
- **Moq**: Mocking framework for dependency injection
- **Microsoft.NET.Test.Sdk**: Test execution and discovery

### Development Tools
- **Visual Studio 2022 17.8+**: Primary IDE
- **.NET CLI**: Command-line build and test execution
- **Git**: Version control and collaboration

## User Flows

### Primary User Journey: Creating a Journal Entry

1. **App Launch**
   - Async database initialization
   - UI loads with empty form fields

2. **Content Input**
   - User types journal text (max 200 characters)
   - Real-time character count validation
   - Error messages for invalid input

3. **Metric Selection**
   - Mood slider: 1-10 scale with visual feedback
   - Social Anxiety slider: 1-10 scale
   - Regretability slider: 1-10 scale

4. **Save Operation**
   - Validation checks all required fields
   - Save button disabled if validation fails
   - Loading state during async save operation
   - Success: Form resets, user feedback
   - Error: User-friendly error message displayed

5. **Data Persistence**
   - Entry saved to local SQLite database
   - Automatic timestamp assignment
   - Data integrity verification

### Error Scenarios

#### Network/Database Issues
- Graceful degradation with offline functionality
- Clear error messages for database failures
- Retry mechanisms for transient errors

#### Input Validation Failures
- Immediate feedback for invalid text length
- Visual indicators for required fields
- Contextual help text

## Data Models

### JournalEntry Model
```csharp
public class JournalEntry
{
    [PrimaryKey, AutoIncrement]
    public int Id { get; set; }
    public DateTime CreatedAt { get; set; }
    public string Text { get; set; } = "";
    public int Mood { get; set; }
    public int SocialAnxiety { get; set; }
    public int Regretability { get; set; }
}
```

**Purpose**: Represents a single journal entry with emotional metrics
**Constraints**: Text limited to 200 characters, metrics 1-10 range
**Indexing**: Primary key auto-increment, CreatedAt for chronological sorting

### UserSettings Model
```csharp
public class UserSettings
{
    [PrimaryKey]
    public int Id { get; set; } = 1; // Singleton
    public bool EnableReminders { get; set; }
}
```

**Purpose**: Application configuration (future expansion)
**Pattern**: Singleton pattern with fixed ID
**Extensibility**: Ready for additional user preferences

### Passage Model
```csharp
public class Passage
{
    [PrimaryKey, AutoIncrement]
    public int Id { get; set; }
    public string Title { get; set; } = "";
    public string Content { get; set; } = "";
}
```

**Purpose**: Content management for future features
**Status**: Currently unused, reserved for expansion

## Security Considerations

### Data Privacy
- **Local Storage**: All data stored locally on device
- **No External Transmission**: No cloud sync or data sharing
- **User Consent**: No personal data collection beyond user input

### Database Security
- **SQLite Encryption**: No additional encryption (local device security)
- **Access Control**: Database file permissions follow OS defaults
- **Data Integrity**: SQLite WAL mode for atomic transactions

### Input Validation
- **XSS Prevention**: Text input sanitized through SQLite parameters
- **SQL Injection**: Parameterized queries prevent injection attacks
- **Length Limits**: Input constraints prevent buffer overflow

### Platform Security
- **Android Permissions**: Minimal permissions required
- **iOS Entitlements**: Standard app capabilities only
- **Code Signing**: Standard platform code signing requirements

## Deployment Strategy

### Target Platforms
- **Primary**: Android (API 21+)
- **Secondary**: iOS 15.0+, Windows 10.0.17763.0+, macOS 15.0+

### Build Configuration
- **Debug**: Development builds with logging
- **Release**: Optimized builds with AOT compilation
- **Platform-Specific**: Conditional compilation for platform features

### Distribution
- **Android**: APK via Google Play Store
- **iOS**: IPA via App Store
- **Windows/macOS**: MSIX/Sideload for enterprise deployment

### CI/CD Pipeline
```yaml
# GitHub Actions example
name: Build and Test
on: [push, pull_request]
jobs:
  test:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: "9.0.x"
      - name: Test
        run: dotnet test --verbosity normal
      - name: Build Android
        run: dotnet build -c Release -f net9.0-android
```

### Version Management
- **Semantic Versioning**: Major.Minor.Patch format
- **Changelog**: Detailed release notes
- **Backward Compatibility**: API stability considerations

## Future Enhancements

### Short-Term (3-6 months)
1. **Settings Page**: Implement UserSettings functionality
2. **Entry History**: View and edit previous entries
3. **Data Export**: CSV/PDF export capabilities
4. **Dark Mode**: Theme switching support

### Medium-Term (6-12 months)
1. **Analytics Dashboard**: Trends and insights visualization
2. **Cloud Backup**: Optional iCloud/Google Drive sync
3. **Reminders**: Configurable journaling notifications
4. **Multi-Language**: Localization support

### Long-Term (1+ years)
1. **Advanced Analytics**: AI-powered insights and recommendations
2. **Social Features**: Anonymous community sharing
3. **Integration APIs**: Health app connectivity (Apple Health, Google Fit)
4. **Wearable Support**: Companion apps for smartwatches

### Technical Improvements
1. **Performance**: Database query optimization and caching
2. **Security**: End-to-end encryption for sensitive data
3. **Accessibility**: Screen reader and gesture navigation
4. **Testing**: UI automation and performance benchmarking

---

**Version**: 1.0.0
**Last Updated**: January 17, 2026
**Status**: Production Ready
**Test Coverage**: 85%+
**Supported Platforms**: Android (Primary), iOS/Windows/macOS (Available)